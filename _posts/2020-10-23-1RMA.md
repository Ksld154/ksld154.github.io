---
title: "1RMA: Re-envisioning Remote Memory Access forMulti-tenant Datacenters"
tags: `Paper Note` `2020` `SIGCOMM`  `RDMA` 
show_edit_on_github: false
---

## 1 Background & Issues
* å‚³çµ±çš„RDMAä¸¦ä¸é©ç”¨æ–¼Multi-tenant datacenter
    *  ä½¿ç”¨éå¤šé€£ç·š
        *  åŸºæ–¼**InfiniBand** RDMAçš„ç‰¹æ€§, NICæœƒcacheä½host-remoteæ¯ä¸€æ¢é€£ç·šçš„state
        *  é€£ç·šæ˜¯per app-pair, åœ¨å¤§æµé‡ç’°å¢ƒæœƒå ç”¨éå¤šNIC cache
    *  Induced Ordering
        *  ç•¶å¤šç­†requestè¦å…±ç”¨åŒä¸€æ¢connectionæ™‚
        *  ç”±æ–¼RDMAè¦æ±‚FIFOæ–¹å¼è™•ç†ï¼Œå¯èƒ½ç™¼ç”Ÿhead-of-line blockingï¼Œå°è‡´é«˜priority requesté™·å…¥stravation
    *  Security Issue
        *  åŠ å¯†å®Œå…¨äº¤ç”±NICè™•ç†ï¼Œappä¸èƒ½å¿«é€Ÿåškey rotation
    *  Hardware Congestion Control
        *  Switchå¿…é ˆç”¨ Priority Flow Control(PFC)ï¼Œæä¾›RDMA losslessç’°å¢ƒ
            *  ä½†PFCæœƒæœ‰deadlock, poor failure isolation, head-of-line blocking
        *  å¯«æ­»åœ¨ç¶²å¡ï¼Œdeployå¾Œå¾ˆé›£æ‰‹å‹•èª¿æ•´
    *  Error Handling
        *  ç•¶æ–·ç·šæ™‚ï¼Œclientä¸çŸ¥é“serverç«¯çš„RDMA opåˆ°åº•æœ‰æ²’æœ‰æ”¹é“remote memory

## 2 Introduction
* 1RMAé‡æ–°è¨­è¨ˆåŠƒåˆ†ç¶²å¡èˆ‡è»Ÿé«”é–“çš„è²¬ä»»ï¼ŒæŠŠåŸæœ¬å…¨éƒ¨éƒ½ç”±NICå®Œæˆçš„å·¥ä½œï¼Œæ‹†ä¸€äº›å‡ºä¾†çµ¦è»Ÿé«”åš
    * ![](https://i.imgur.com/jAYNtYq.png)
    * ç¡¬é«”å°ˆæ³¨RMA read/write, encrypt
    * è»Ÿé«”è² è²¬CC, op pacing, timeout policy
* è¨­è¨ˆç›®æ¨™ï¼š
    1. **No Connections**
        * ä¸ç”¨cache connection state
        * æ¯å€‹opéƒ½è¦–ç‚ºç¨ç«‹ => per-op retry/fail-recovery
    2. **Small-sized ops, solicitation based**
        * **Hardware** solicitation window to prevent TCP incast 
    3. **Software Congestion Control**
        *  dynamic
    4. Software-defined resource allocation
        * ä¸åƒå‚³çµ±RDMAç‚ºäº†æ»¿è¶³losslessçš„ç¶²è·¯ç’°å¢ƒï¼Œè€Œå¿…é ˆè¦åœ¨ç¶²å¡ä¸Šcacheä¸€å †state
        * é€épriorityæ±ºå®šè¦åˆ†é…çµ¦requestå¤šå°‘è³‡æº
    5. First-Class **Security**
        * è®“appæœ‰æ¬Šé™åškey rotation
        * æ¯å€‹memory regionç”¨ä¸åŒkeyä¿è­·

## 3 1RMA Overview
![](https://i.imgur.com/4FEiHv7.png)
* Step1~2 Get $K_d$, $RegionID$
* Step3   Solicitation windowæœ‰ç©ºä½çš„æ™‚å€™ï¼Œæ‰èƒ½issue requeståˆ°NIC
    * SW: chunk, SW->NICçš„é€Ÿç‡ã€Congestion Control (Slow)
    * HW: ç”¨Soli. windowåšAdmission Control (Fast)
* Step4   $K_d$ sign request
* Step6   $K_d$ encrypt response

## 4 1RMA Design In Depth
### 4-1 Security
* Derived Key
    * ![](https://i.imgur.com/sBkXzXr.png)
    * $K_dï¼š$ Session Key,  per-process, ç”¨ä¾†signè·Ÿ(encrypt)
        * clientæ‹¿åˆ°$K_d$å¾Œæ‰æœ‰è³‡æ ¼åšRDMA request
    * $K_rï¼š$ Region Key, per-memory-block, å­˜åœ¨remote NIC
    * å¯é˜²ä»¥ä¸‹æ”»æ“Š
        1. Replay attack: å› serverç”Ÿ$K_d$æœ‰åŠ salt
        2. inject ciphertext: æ²’$K_d$ç„¡æ³•decrypt
        3. Access other's remote memory: å¯çŒœå‡º`RegionID`çŒœä¸å‡º$K_d$
### 4-2 Hardware
![](https://i.imgur.com/UeuVx3F.png)
* **RRT:** static table, å­˜`RegionID`, `Kr`å°æ‡‰åˆ°çš„memory range
* **CST:** single in-flight operation
* **Solicitaion Window:** Admission Control, é™åˆ¶FIFOä¸­å¤šå°‘packetèƒ½é€²å…¥ç¶²è·¯
* Number of memory regions for RMA based on **tasks**, not task-pairs
    *  manageable in finite resources
* Timeout: ç­‰å¤ªä¹…éƒ½æ²’é€²å…¥windowå°±ç›´æ¥timeout
    * é¿å…head-of-line blocking, æä¾›congestion signal
### 4-3 Software
*    ![](https://i.imgur.com/g9CzVh9.png)
*    **CommandExecutor**: chunking, CC, pacing
*    **ComamndPortal**: App. memory <---> NIC register mapping

## 5 Other 1RMA Ops
### 5-1 RMA Write
* è¦æ±‚Remoteå°localåšRMA read
* Con: å¤šèŠ±ä¸€å€‹RTT
* Pro: 
    * æ©Ÿåˆ¶å¯ä»¥æ²¿ç”¨RMA readçš„ï¼Œä¸ç”¨é‡æ–°è¨­è¨ˆ
    * clientæœƒæ¯”remoteæ™štimeout
        * å¯é¿å…æ–·ç·šæ™‚ï¼Œclientä¸çŸ¥é“write remote memoryåˆ°åº•æœ‰æ²’æœ‰æˆåŠŸ 
### 5-2 Rekey
* ç”¨RMA writeåškey rotation
* æˆæœ¬ä½ï¼šInstall a new region key ğ¾ğ‘Ÿ in 1 RRT
* å‚³çµ±æ–¹æ³•å•é¡Œ
    * High transient connection usage: è¦å…ˆå»ºç”¨æ–°keyçš„é€£ç·š
    * Bursts of connection failure: æ›keyçš„æ™‚å€™æœƒç˜‹ç‹‚auth fail

## 6 Congestion Control
* SW: ä¸»è¦åšCCé‹ç®—
    * HW: åµæ¸¬delayæä¾›çµ¦SW
* ç”¨**Delay**ç•¶ä½œCCæŒ‡æ¨™
* Connection-free 1RMA, æ•…å¯ä»¥**åªåœ¨requestç«¯åšCC**å°±å¥½
    * per remote NIC
* Congestion Window
    * Remote: æ¯å¼µremote NIC/direction ä¸€å€‹
    * Local:  å…±ç”¨åŒä¸€å€‹
* Local CC Algo
    * ![](https://i.imgur.com/lWtpeP5.png)
* opsâ€™ issue rate = $\frac{OpSize*CWND}{RTT}$